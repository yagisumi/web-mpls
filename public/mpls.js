!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).window=t.window||{})}(this,function(t){"use strict";class e extends Error{constructor(...t){let e=null,s=void 0;if("string"==typeof t[0]&&(s=t[0]),t[0]instanceof Error?e=t[0]:t[1]instanceof Error&&(e=t[1]),super(s),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:this.constructor.name,writable:!0}),e&&e.stack){if(Error.hasOwnProperty("captureStackTrace"))return Error.captureStackTrace(this,this.constructor),void(this.stack&&(this.stack=this.mergeStackTrace(this.stack,e.stack)));const t=new Error(s);if(t.stack){const s=t.stack.split("\n"),i=[s[0],...s.slice(3)].join("\n");this.stack=this.mergeStackTrace(i,e.stack)}}}mergeStackTrace(t,e){if(!e)return t;const s=t.split("\n"),i=e.split("\n"),n=[];return s.forEach(t=>{i.includes(t)||n.push(t)}),[...n,...i].join("\n")}}class s{constructor(t,e=!0){this.pos=0,this.limit=-1,this.buf=t,this.view=new DataView(t),this.littleEndian=e}stringify(t){const e=[];for(let s in t)e.push(`${s}: ${t[s]}`);return`{ ${e.join(", ")} }`}setLimit(t){if(t<0||this.buf.byteLength<t)throw new RangeError(`Position out of range of buffer. setLimit: ${this.stringify({limit:t,bufferLength:this.buf.byteLength})}`);return this.limit=t,this}resetLimit(){return this.limit=-1,this}getLimit(){return this.limit>=0?this.limit:null}getPos(){return this.pos}seek(t){if(t<0||this.buf.byteLength<t)throw new RangeError(`Position out of range of buffer. seek: ${this.stringify({pos:t,bufferLength:this.buf.byteLength})}`);return this.pos=t,this}skip(t){return this.checkPos(this.pos,t,"skip"),this.pos+=t,this}checkPos(t,e,s){if(this.limit>=0&&t+e>this.limit)throw new RangeError(`Position exceeds limit. ${s}: ${this.stringify({pos:t,limit:this.limit,readByte:e})}`);if(t+e>this.buf.byteLength)throw new RangeError(`Position exceeds buffer length. ${s}: ${this.stringify({pos:t,bufferLength:this.buf.byteLength,readByte:e})}`)}readString(t){this.checkPos(this.pos,t,"readString");const e=[];for(let s=0;s<t;s++)e.push(this.view.getUint8(this.pos+s));const s=String.fromCharCode(...e);return this.pos+=t,s}peekString(t,e){const s=null==e?this.pos:e;this.checkPos(s,t,"peekString");const i=[];for(let e=0;e<t;e++)i.push(this.view.getUint8(s+e));return String.fromCharCode(...i)}readBuffer(t){this.checkPos(this.pos,t,"readBuffer");const e=this.buf.slice(this.pos,this.pos+t);return this.pos+=t,e}peekBuffer(t,e){const s=null==e?this.pos:e;return this.checkPos(s,t,"peekBuffer"),this.buf.slice(s,s+t)}readInt8(){this.checkPos(this.pos,1,"readInt8");const t=this.view.getInt8(this.pos);return this.pos+=1,t}peekInt8(t){const e=null==t?this.pos:t;return this.checkPos(e,1,"peekInt8"),this.view.getInt8(e)}readUint8(){this.checkPos(this.pos,1,"readUint8");const t=this.view.getUint8(this.pos);return this.pos+=1,t}peekUint8(t){const e=null==t?this.pos:t;return this.checkPos(e,1,"peekUint8"),this.view.getUint8(e)}readInt16(){this.checkPos(this.pos,2,"readInt16");const t=this.view.getInt16(this.pos,this.littleEndian);return this.pos+=2,t}peekInt16(t){const e=null==t?this.pos:t;return this.checkPos(e,2,"peekInt16"),this.view.getInt16(e,this.littleEndian)}readInt16LE(){this.checkPos(this.pos,2,"readInt16LE");const t=this.view.getInt16(this.pos,!0);return this.pos+=2,t}peekInt16LE(t){const e=null==t?this.pos:t;return this.checkPos(e,2,"peekInt16LE"),this.view.getInt16(e,!0)}readInt16BE(){this.checkPos(this.pos,2,"readInt16BE");const t=this.view.getInt16(this.pos,!1);return this.pos+=2,t}peekInt16BE(t){const e=null==t?this.pos:t;return this.checkPos(e,2,"peekInt16BE"),this.view.getInt16(e,!1)}readUint16(){this.checkPos(this.pos,2,"readUint16");const t=this.view.getUint16(this.pos,this.littleEndian);return this.pos+=2,t}peekUint16(t){const e=null==t?this.pos:t;return this.checkPos(e,2,"peekUint16"),this.view.getUint16(e,this.littleEndian)}readUint16LE(){this.checkPos(this.pos,2,"readUint16LE");const t=this.view.getUint16(this.pos,!0);return this.pos+=2,t}peekUint16LE(t){const e=null==t?this.pos:t;return this.checkPos(e,2,"peekUint16LE"),this.view.getUint16(e,!0)}readUint16BE(){this.checkPos(this.pos,2,"readUint16BE");const t=this.view.getUint16(this.pos,!1);return this.pos+=2,t}peekUint16BE(t){const e=null==t?this.pos:t;return this.checkPos(e,2,"peekUint16BE"),this.view.getUint16(e,!1)}readInt32(){this.checkPos(this.pos,4,"readInt32");const t=this.view.getInt32(this.pos,this.littleEndian);return this.pos+=4,t}peekInt32(t){const e=null==t?this.pos:t;return this.checkPos(e,4,"peekInt32"),this.view.getInt32(e,this.littleEndian)}readInt32LE(){this.checkPos(this.pos,4,"readInt32LE");const t=this.view.getInt32(this.pos,!0);return this.pos+=4,t}peekInt32LE(t){const e=null==t?this.pos:t;return this.checkPos(e,4,"peekInt32LE"),this.view.getInt32(e,!0)}readInt32BE(){this.checkPos(this.pos,4,"readInt32BE");const t=this.view.getInt32(this.pos,!1);return this.pos+=4,t}peekInt32BE(t){const e=null==t?this.pos:t;return this.checkPos(e,4,"peekInt32BE"),this.view.getInt32(e,!1)}readUint32(){this.checkPos(this.pos,4,"readUint32");const t=this.view.getUint32(this.pos,this.littleEndian);return this.pos+=4,t}peekUint32(t){const e=null==t?this.pos:t;return this.checkPos(e,4,"peekUint32"),this.view.getUint32(e,this.littleEndian)}readUint32LE(){this.checkPos(this.pos,4,"readUint32LE");const t=this.view.getUint32(this.pos,!0);return this.pos+=4,t}peekUint32LE(t){const e=null==t?this.pos:t;return this.checkPos(e,4,"peekUint32LE"),this.view.getUint32(e,!0)}readUint32BE(){this.checkPos(this.pos,4,"readUint32BE");const t=this.view.getUint32(this.pos,!1);return this.pos+=4,t}peekUint32BE(t){const e=null==t?this.pos:t;return this.checkPos(e,4,"peekUint32BE"),this.view.getUint32(e,!1)}}const i={1:"MPEG-1 Video",2:"MPEG-2 Video",3:"MPEG-1 Audio",4:"MPEG-2 Audio",128:"LPCM",129:"AC-3",130:"DTS",131:"TrueHD",132:"AC-3 Plus",133:"DTS-HD",134:"DTS-HD Master",234:"VC-1",27:"H.264",144:"Presentation Graphics",145:"Interactive Graphics",146:"Text Subtitle"},n={1:"480i",2:"576i",3:"480p",4:"1080i",5:"720p",6:"1080p",7:"576p"},r={1:"23.976",2:"24",3:"25",4:"29.97",6:"50",7:"59.94"},o={1:"Mono",3:"Stereo",6:"Multi Channel",12:"Combo"},a={1:"48 Khz",4:"96 Khz",5:"192 Khz",12:"48/192 Khz",14:"48/96 Khz"};class h extends e{}function c(t){const e=new s(t,!1);try{const s={_size_of_file:t.byteLength,type_indicator:e.readString(4),type_indicator2:e.readString(4),playlist_start_address:e.readUint32BE(),playlist_mark_start_address:e.readUint32BE(),extension_data_start_address:e.readUint32BE(),app_info_play_list:p(e.skip(20)),playlist:{length:0,number_of_playitems:0,number_of_subpaths:0,playitems:[],subpaths:[]},playlist_mark:{length:0,number_marks:0,entries:[]}};if("MPLS"!==s.type_indicator)throw new h(`type_indecator should be 'MPLS' but '${s.type_indicator}'`);return s.playlist=function(t){try{const e={length:t.readUint32BE(),number_of_playitems:t.skip(2).readUint16BE(),number_of_subpaths:t.readUint16BE(),playitems:[],subpaths:[]};for(let s=0;s<e.number_of_playitems;s++){const s=t.getPos(),i=t.peekUint8(t.getPos()+12),n={length:t.readUint16BE(),clip_file:t.readString(5),codec_id:t.readString(4),is_multi_angle:0!=(16&i),connection_condition:7&i,stc_id:t.skip(2).readUint8(),in_time:t.readUint32BE(),out_time:t.readUint32BE(),UO_mask_table:t.readBuffer(8),random_access_flag:0!=(128&t.readUint8()),still_mode:t.readUint8()};if(t.skip(2),n.is_multi_angle){const e=t.readUint8();t.skip(1),t.skip(10*e)}n.stn=l(t),e.playitems.push(n),t.seek(s+2+n.length)}for(let s=0;s<e.number_of_subpaths;s++){const e=t.getPos(),s={length:t.readUint32BE(),type:t.skip(1).readUint8()};t.seek(e+4+s.length)}return e}catch(t){throw new h("parse error",t)}}(e.seek(s.playlist_start_address)),s.playlist_mark=function(t){try{const e={length:t.readUint32BE(),number_marks:t.readUint16BE(),entries:[]},s=(e.length-2)/14,i=(e.length-2)%14;if(0!==i)throw new h("unexpected length of PlayListMark (length: playlist_mark.length)");for(let i=0;i<s;i++)e.entries.push({mark_type:t.skip(1).readUint8(),play_item_ref:t.readUint16BE(),time:t.readUint32BE(),entry_es_pid:t.readUint16BE(),duration:t.readUint32BE()});return e}catch(t){throw new h("parse error",t)}}(e.seek(s.playlist_mark_start_address)),function(t){let e=0;t.playlist.playitems.forEach(t=>{t._abs_start_time=e,t._play_time_msec=(t.out_time-t.in_time)/45,t._play_time_hhmmss=d(t._play_time_msec),e+=t.out_time-t.in_time}),t.playlist_mark.entries.forEach(e=>{const s=t.playlist.playitems[e.play_item_ref];s&&(e._abs_start_msec=((s._abs_start_time||0)+e.time-s.in_time)/45,e._abs_start_hhmmss=d(e._abs_start_msec))})}(s),s}catch(t){throw new h("parse error",t)}}function p(t){try{const e=t.peekUint8(56);return{length:t.readUint32BE(),playlist_playback_type:t.readUint8(),playlist_random_access_flag:0!=(128&e),audio_mix_app_flag:0!=(64&e),lossless_may_bypass_mixer_flag:0!=(32&e),UO_mask_table:t.readBuffer(8)}}catch(t){throw new h("parse error",t)}}function l(t){try{const e=t.getPos(),s={length:t.readUint16BE(),num_primary_video:t.skip(2).readUint8(),num_primary_audio:t.readUint8(),num_pg:t.readUint8(),num_ig:t.readUint8(),num_secondary_audio:t.readUint8(),num_secondary_video:t.readUint8(),num_PIP_PG:t.readUint8(),streams:[]};t.skip(5);for(let e=0;e<s.num_primary_video;e++)s.streams.push(u(t));for(let e=0;e<s.num_primary_audio;e++)s.streams.push(u(t));for(let e=0;e<s.num_pg;e++)s.streams.push(u(t));for(let e=0;e<s.num_ig;e++)s.streams.push(u(t));return t.seek(e+s.length+2),s}catch(t){throw new h("parse error")}}function u(t){const e=t.getPos();try{const s={length:t.readUint8(),stream_type:t.readUint8(),attributes:{length:0,coding_type:0}};switch(s.stream_type){case 1:s.pid=t.readUint16BE();break;case 2:case 4:s.subpath_id=t.readUint8(),s.subclip_id=t.readUint8(),s.pid=t.readUint16BE();break;case 3:s.subpath_id=t.readUint8(),s.pid=t.readUint16BE()}t.seek(e+s.length+1);const c=t.getPos(),p={length:t.readUint8(),coding_type:t.readUint8()};p._coding_type=i[p.coding_type];const l=t.peekUint8();switch(p.coding_type){case 1:case 2:case 234:case 27:t.skip(1),p.format=l>>4&15,p.rate=15&l,p._format=n[p.format],p._rate=r[p.rate];break;case 3:case 4:case 128:case 129:case 130:case 131:case 132:case 133:case 134:t.skip(1),p.format=l>>4&15,p.rate=15&l,p._format=o[p.format],p._rate=a[p.rate],p.lang_code=t.readString(3);break;case 144:case 145:p.lang_code=t.readString(3);break;case 146:p.char_code=t.readUint8(),p.lang_code=t.readString(3)}return t.seek(c+p.length+1),s.attributes=p,s}catch(t){throw new h("parse error")}}function d(t){const e=Math.floor(t/36e5),s=t-36e5*e,i=Math.floor(s/6e4),n=s-6e4*i,r=Math.floor(n/1e3),o=n-1e3*r,a=Math.floor(o);return`${e>=100?e:("00"+e).slice(-2)}:${("00"+i).slice(-2)}:${("00"+r).slice(-2)}.${("000"+a).slice(-3)}`}t.mpls=function(t){return c(t)},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=mpls.js.map
